<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 8. Advanced Features of the SIP Servlets Server</title><link rel="stylesheet" type="text/css" href="css/telestax_org.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"/><link rel="home" href="index.html" title="SIP Servlets Server User Guide"/><link rel="up" href="index.html" title="SIP Servlets Server User Guide"/><link rel="prev" href="ch07.html" title="Chapter 7. Security"/><link rel="next" href="ch09.html" title="Chapter 9. Best Practices"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><p xmlns:d="http://docbook.org/ns/docbook" id="title"><a href="http://www.telestax.com" class="site_href"><strong>TeleStax.org</strong></a><a href="http://www.telestax.com/" class="doc_href"><strong>Community Documentation</strong></a></p><ul xmlns:d="http://docbook.org/ns/docbook" class="docnav"><li class="previous"><a accesskey="p" href="ch07.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="ch09.html"><strong>Next</strong></a></li></ul><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="afotsss-Advanced_Features_of_the_SIP_Servlets_Server"/>Chapter 8. Advanced Features of the SIP Servlets Server</h1></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ch08.html#mipbx-Media_Support">8.1. Media Support</a></span></dt><dd><dl><dt><span class="section"><a href="ch08.html#d0e5081">8.1.1. JSR 309: Media Server Control API</a></span></dt></dl></dd><dt><span class="section"><a href="ch08.html#sscacc-MSS_Concurrency_and_Congestion_Control">8.2. Concurrency and Congestion Control</a></span></dt><dt><span class="section"><a href="ch08.html#mssstun-MSS_STUN">8.3. STUN Support</a></span></dt><dt><span class="section"><a href="ch08.html#sscacc-MSS_JSR289_Extensions">8.4. Mobicents vendor-specific Extensions to JSR 289</a></span></dt><dt><span class="section"><a href="ch08.html#stf-CDI_Telco_Framework">8.5. CDI Telco Framework</a></span></dt><dt><span class="section"><a href="ch08.html#ssds-Diameter_Support">8.6. Diameter Support</a></span></dt><dt><span class="section"><a href="ch08.html#saimse-SIP_and_IMS_Extensions">8.7. SIP and IMS Extensions</a></span></dt><dt><span class="section"><a href="ch08.html#ss_jslee_interop">8.8. SIP Servlets - JAIN SLEE Interoperability</a></span></dt><dt><span class="section"><a href="ch08.html#d0e6130">8.9. Eclipse IDE Tools</a></span></dt><dd><dl><dt><span class="section"><a href="ch08.html#d0e6141">8.9.1. Pre-Install requirements</a></span></dt><dt><span class="section"><a href="ch08.html#d0e6146">8.9.2. Installation</a></span></dt><dt><span class="section"><a href="ch08.html#d0e6157">8.9.3. SIP Servlets Core Plug-in</a></span></dt><dt><span class="section"><a href="ch08.html#d0e6165">8.9.4. SIP Phone Plug-in</a></span></dt></dl></dd></dl></div><p>The advanced features of SIP Servlets include Concurrency and 
Congestion Control, load balancing with the Mobicents Load Balancer, and, exclusively for MSS for JBoss, clustering and failover support.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mipbx-Media_Support"/>8.1. Media Support</h2></div></div></div><p>Mobicents SIP Servlets provides support for applications to set up
  calls through SIP by implementing the SIP Servlets
  1.1 Specification.</p><p>As most Telco services have the need for managing and
  controlling media (for example, to play announcements, mix calls and recognize
  DTMF), Mobicents SIP Servlets allows applications to control media through JSR 309.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5081"/>8.1.1. JSR 309: Media Server Control API</h3></div></div></div><p>This specification is a protocol agnostic API for Media Server
    Control. It provides a portable interface to create media rich
    applications with IVR, Conferencing, Speech Recognition, and similar
    features.</p><p>Mobicents Media Server provides an implementation of the <a class="ulink" href="http://jcp.org/en/jsr/detail?id=309">JSR 309 specification</a> using the MGCP protocol, to
    allow any Media Server (located in the same Virtual Machine or
    on a remote server) supporting MGCP to be controlled.</p><p>The following examples demonstrate its usage:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="ulink" href="http://www.mobicents.org/mss-jsr309-demo.html">Media Example</a> : a SIP Servlet application showing how to use media
        capabilities (Media playback, Recording, Text to Speech with FreeTTS and DTMF detection).</p></li><li class="listitem"><p><a class="ulink" href="http://www.mobicents.org/conference-demo-jsr309.html">Conference Demo</a> : a Conference Media Server demo application built on GWT
        with server-push updates.</p></li><li class="listitem"><p><a class="ulink" href="http://www.mobicents.org/shopping-demo-jsr309.html">Shopping Example</a> : a Converged JEE Application showing SEAM
        integration, JEE, Media integration with TTS and DTMF support.</p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sscacc-MSS_Concurrency_and_Congestion_Control"/>8.2. Concurrency and Congestion Control</h2></div></div></div><p>Concurrency and Congestion control refer to settings that
  define the way in which messages are processed under heavy load. The way Mobicents SIP Servlets Server processes messages in a production environment is crucial to ensure quality of service for customers.</p><p>Concurrency control mode tuning affects the way in which
  the SIP Servlets Server processes messages, whereas Congestion Control tuning affects the point at which the server
  begins rejecting new requests. Both of these parameters can be set using the following methods: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Through the SIP Servlets Management Console.</p></li><li class="listitem"><p>Editing
  the server's <code class="filename">server.xml</code> or  <code class="filename">standalone-sip.xml</code> configuration file.</p></li><li class="listitem"><p>From the
  <code class="literal">dispatcher</code> MBean.</p></li><li class="listitem"><p>From the Embedded Jopr integrated
  management platform.</p></li></ul></div><p><strong>Concurrency Control. </strong>The JSR 289 expert group does not specify how concurrency control should be implemented.  </p><p>Mobicents SIP Servlets for JBoss and Mobicents SIP Servlets for Tomcat have concurrency control implemented as
    a configurable mode, which defines the way in which the SIP Servlets Server processes messages.</p><p>It has to be noted that this concurrency control mechanism is not cluster aware and will work per node only, it is not a cluster wide lock.</p><p>The following modes are provided, and cater for the particular setup required in an implementation:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">None</span></dt><dd><p>All SIP messages are processed as soon as possible in a thread
        from the global thread pool.</p><p>When two messages
        belong to the same <code class="literal">SipSession</code>, they can be concurrently processed. Ensure that SIP Messages that access shared resources (such as the session attribute) concurrently are synchronized in a
        thread-safe manner.</p></dd><dt><span class="term">Transaction</span></dt><dd><p>Bypass the SIP Servlets request/response executors, and utilize the JAIN SIP built-in Transaction serialization to manage race conditions on the same transaction.</p><p>By default, the SIP Servlets server uses a ThreadPoolExecutor linked to a LinkedBlockingQueue to dispatch the request/response threads. The container can thus handles two different response (for example a 180 Ringing and a 200 OK) concurrently, a race condition can occur where the second response overtakes the first one (200 OK dispatched to the application before the 180 Ringing).
        </p></dd><dt><span class="term">SipSession</span></dt><dd><p>SIP messages are processed as soon as possible except for messages originating from the same <code class="literal">SipSession</code>. These messages are excluded from any simultaneous processing. </p><p>Messages from the same
        <code class="literal">SipSession</code> are processed sequentially, in the order they  originally arrived. </p><p>Two (or more) messages from different
        <code class="literal">SipSession</code> instances in the same
        <code class="literal">SipApplicationSession</code> may be processed
        simultaneously. For this reason, ensure that SIP Messages that access shared resources (such as the session attribute) concurrently  are synchronized in a
        thread-safe manner. </p><p>Thread-safety is particularly important in Back-to-Back User Agent (B2BUA) cases,  where each communication leg of the
        B2BUA consists of a different <code class="literal">SipSession</code> in the
        same <code class="literal">SipApplicationSession</code>.</p></dd><dt><span class="term">SipApplicationSession</span></dt><dd><p>SIP messages are processed as soon as possible, with the
        guarantee that no two messages from the same
        <code class="literal">SipSession</code> <span class="emphasis"><em>or</em></span> from the same
        <code class="literal">SipApplicationSession</code> will ever be processed
        simultaneously.  Of all the available methods, this mode is the best choice for guaranteed  thread-safety. </p><p>If applications  access shared resources in an unmanaged
        way (for example,  by accessing a <code class="literal">SipSession</code> attribute
        from an unmanaged thread, or from an Enterprise JavaBean) access will not be synchronized.</p></dd></dl></div><p><strong>Congestion Control. </strong>Mobicents Sip Servlets currently provides the following  congestion
    control mechanisms:</p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Changing Congestion Control Settings </h2><p>
All the settings and congifurations starting with gov.nist.javax.sip are located in the $JBOSS-HOME/standalone/configuration/mss-sip-stack.properties file. The section below will provide further details.
</p></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Congestion control is largely application-specific and it is implemented in a pipeline. 
      First messages arrive in the JAIN SIP message queue where they will wait on the locks needed 
      before they can be processed. To avoid keeping too many messages in the queue and potentially
       running out of memory, older messages are discarded without any error indication. This prevents
        spam and flood DoS attacks to accumulate large backlog and render the server unresponsive. It also
         guranatees flood recovery time of 20 seconds or less, in the mean time retransmissions are
          already queuing so that normal SIP calls can continue without dropping them. After the request has passed the first 
          queue it enters the SIP transaction layer where there is a customizable optional congestion control logic.
          There is one packaged congestion control algorithm which can be enabled by setting the following property
           <code class="literal">gov.nist.javax.sip.SIP_MESSAGE_VALVE=gov.nist.javax.sip.stack.CongestionControlMessageValve</code>.
           For this algorithm you can set the limit value by the following property
          <code class="literal">gov.nist.javax.sip.MAX_SERVER_TRANSACTIONS=2000</code>. 
          You can also implement your own algorithm and change the class name in <code class="literal">gov.nist.javax.sip.SIP_MESSAGE_VALVE</code> to activate it.</p><p>
          
          There is also another optional legacy congestion
           control stage with another queue where messages can be discarded based on dynamic parameters
            such as available JVM heap memory or number of messages in the queue. This method will be deprecated and is not recommended. All SIP messages which
             cannot be processed immediately are put
      into a queue, and  wait for either a free thread or for the lock
      on their session to be released. The  size of the  SIP message
      queue is a tunable parameter, which defaults to
      <code class="literal">1500</code>.</p></li><li class="listitem"><p>If the SIP Message queue becomes full, the
      container immediately begins rejecting  new SIP requests until the queue clears.  This is achieved by using one of the following methods:</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Sending a <code class="literal">503</code> SIP error code  to the originating application.</p></li><li class="listitem"><p>Dropping  incoming
      messages (according to the specified  congestion control policy).</p></li></ul></div></li><li class="listitem"><p>If the container exceeds the  configurable memory threshold (90% by  default), new  SIP requests are rejected   until the
      memory usage falls below the specified memory threshold.  This is achieved by using one of the following methods:</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Sending a <code class="literal">503</code> SIP error code  to the originating application.</p></li><li class="listitem"><p>Dropping  incoming
      messages (according to the specified  congestion control policy).</p></li></ul></div></li></ul></div><p>A background task gathers information about the current server congestion.  The data collection interval   can be adjusted, and congestion control deactivated,  by setting the interval to 0 or a
  negative value.</p><p>The congestion control policy defines how an  incoming
  message is handled when  the server is overloaded.  The following parameters are configurable:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>DropMessage - drop any incoming message</p></li><li class="listitem"><p>ErrorResponse - send a 503 - Service Unavailable response to any
      incoming request (Default).</p></li></ul></div><p><a id="sscacc-Configuring_the_Concurrency_and_Congestion_Control_Settings"/><strong>Configuring the Concurrency and Congestion Control Settings. </strong>The concurrency and congestion control settings can be configured
    through the SIP Servlets Management Console, using the following methods: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Through the SIP Servlets Management Console.</p></li><li class="listitem"><p>Editing
  the server's <code class="filename">server.xml</code> or the <code class="filename">standalone-sip.xml</code> configuration file.</p></li><li class="listitem"><p>From the
  <code class="literal">dispatcher</code> MBean.</p></li><li class="listitem"><p>From the Embedded Jopr integrated
  management platform.</p></li></ul></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Tuning Parameters with the SIP Servlets Management Console</span></dt><dd><p>The easiest way to configure the <span class="guilabel">SIP Message Queue Size</span> and <span class="guilabel">Concurrency Control Mode</span>
        tunable parameters is to open the <code class="literal">SIP Servlets Management Console</code> in your browser (by going to <a class="ulink" href="http://localhost:8080/sip-servlets-management">http://localhost:8080/sip-servlets-management</a>), making
        your changes, and then clicking <span class="guibutton">Apply</span>. </p><div class="figure"><a id="d0e5335"/><p class="title"><strong>Figure 8.1. SIP Servlets Management Console Concurrency and Congestion Control Tuning Parameters</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><a id="sscacc-sas-MSSSManagementConsole-ss-ServerSettings-1"/><img src="images/mss-MSSSManagementConsole-ss-ServerSettings.png" align="middle" alt="SIP Servlets Management Console Concurrency and Congestion Control Tuning Parameters"/></div></div></div><br class="figure-break"/><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Persistent Settings</h2><p>Concurrency and congestion control settings altered through the SIP Servlets Management Console are not saved to the <code class="filename">server.xml</code> on Tomcat, only on JBoss AS7 through the <code class="filename">standalone-sip.xml</code>configuration file.  </p><p>To make settings persistent, append the settings to  the <code class="filename">server.xml</code> file directly.  </p></div></dd><dt><span class="term">Making your changes permanent in <code class="filename">standalone-sip.xml</code> or <code class="filename">server.xml</code> by manual editing</span></dt><dd><p>Alternatively, you can edit your server's
        <code class="filename">standalone-sip.xml</code> or <code class="filename">server.xml</code> configuration file, which has the
        benefit of making your chosen settings changes permanent for Tomcat. Instructions
        follow, grouped by the SIP Servlets Server you are running:</p><div class="procedure"><a id="d0e5375"/><p class="title"><strong>Procedure 8.1. Tuning Mobicents SIP Servlets for JBoss Server Settings for Concurrency and Congestion Control</strong></p><ol class="procedure" type="1"><li class="step"><p class="title"><strong>Open standalone-sip.xml File</strong></p><p>Open the
            <code class="filename"><code class="envar">$JBOSS_HOME/standalone/configuration/standalone-sip.xml </code></code>
            configuration file in a text editor.</p></li><li class="step"><div class="example"><a id="standalone-sip.xml-concurrency-editing"/><p class="title"><strong>Example 8.1. 
Extract from stanalone-sip.xml file with conccurency configuration
</strong></p><div class="example-contents"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">



&lt;subsystem xmlns="urn:org.mobicents:sip-servlets-as7:1.0" application-router="dars/mobicents-dar.properties" stack-properties="mss-sip-stack.properties" path-name="gov.nist" app-dispatcher-class="org.mobicents.servlet.sip.core.SipApplicationDispatcherImpl" concurrency-control-mode="SipApplicationSession" congestion-control-interval="-1"&gt;
            &lt;connector name="sip-udp" protocol="SIP/2.0" scheme="sip" socket-binding="sip-udp"/&gt;
            &lt;connector name="sip-tcp" protocol="SIP/2.0" scheme="sip" socket-binding="sip-tcp"/&gt;
            &lt;connector name="sip-tls" protocol="SIP/2.0" scheme="sip" socket-binding="sip-tls"/&gt;
        &lt;/subsystem&gt;




</pre></div></div><br class="example-break"/></li></ol></div><div class="procedure"><a id="d0e5395"/><p class="title"><strong>Procedure 8.2. Tuning Mobicents SIP Servlets for Tomcat Server Settings for Concurrency and Congestion Control</strong></p><ol class="procedure" type="1"><li class="step"><p class="title"><strong>Open server.xml File</strong></p><p>Open the
            <code class="filename"><code class="envar">$CATALINA_HOME</code>/conf/server.xml</code>
            configuration file in your text editor.</p></li><li class="step"><p class="title"><strong>Add Parameters to &lt;service&gt; Element</strong></p><p>Locate the <span class="markup">&lt;service&gt;</span> element, and add the
            <code class="literal">concurrencyControlMode</code> and/or 
            <code class="literal">sipMessageQueueSize</code> attributes.</p><p>Possible values for the
            <code class="literal">concurrencyControlMode</code> attribute include:
            <em class="replaceable"><code>None</code></em>,
            <em class="replaceable"><code>SipSession</code></em> or
            <em class="replaceable"><code>SipApplicationSession</code></em>.
            <em class="replaceable"><code>SipSession</code></em> is the value of this
            attribute when it is not present—and overridden—in
            <code class="filename">server.xml</code>.</p></li><li class="step"><p class="title"><strong>Define the Correct Attribute Values</strong></p><p>The following  default values for the concurrency and congestion control parameters are used regardless of whether the attributes are defined in the <code class="filename">server.xml</code> file:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>sipMessageQueueSize="1500"</p></li><li class="listitem"><p>backToNormalSipMessageQueueSize="1300"</p></li><li class="listitem"><p>congestionControlCheckingInterval="30000" (30 seconds, in milliseconds)</p></li><li class="listitem"><p>memoryThreshold="95" (in percentage)</p></li><li class="listitem"><p>backToNormalMemoryThreshold="90" (in percentage)</p></li><li class="listitem"><p>congestionControlPolicy="ErrorResponse"</p></li></ul></div><p>Experimentation is required for these tuning parameters depending on the operating system and server.</p></li></ol></div></dd><dt><span class="term">Tuning Parameters from the dispatcher MBean</span></dt><dd><p>Navigate to the <code class="literal">dispatcher</code> MBean from
        Mobicents SIP Servlets for JBoss's JMX console. </p><p>All changes performed
        at run time are effective immediately, but do not persist across
        reboots for Tomcat, only on JBoss AS7.  the <code class="filename">server.xml</code> must be appended with the settings in order to make the configuration persistent.</p><p>When editing the <code class="literal">dispatcher</code> MBean from
        Mobicents SIP Servlets for JBoss's JMX console, values allowed for the
        concurrency control mode are <strong class="userinput"><code>None</code></strong>,
        <strong class="userinput"><code>SipSession</code></strong> or
        <strong class="userinput"><code>SipApplicationSession</code></strong>.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mssstun-MSS_STUN"/>8.3. STUN Support</h2></div></div></div><p>The Session Traversal Utilities for NAT (STUN) prococol is used in
  Network Address Translation (NAT) traversal for real-time voice, video,
  messaging, and related interactive IP application communications. This
  light-weight, client-server protocol allows applications passing through a
  NAT to obtain the public IP address for the UDP connections the application
  uses to connect to remote hosts.</p><p>STUN support is provided at the SIP connector level, using the <a class="ulink" href="https://stun4j.dev.java.net/">STUN for Java</a> project. The STUN
  for Java project provides a Java implementation of the STUN Protocol (RFC
  3489), which allows each SIP connector to select whether it should use STUN
  to discover a public IP address, and then use this address in the SIP messages
  sent through the connector.</p><p>To make a SIP connector STUN-enabled, three attributes must be
  appended to the <span class="markup">&lt;connector&gt;</span> child element in the <code class="filename">server.xml</code> or <span class="markup">&lt;socket-binding&gt;</span> child element in <code class="filename">standalone-sip.xml</code>
  file. The properties are:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>useStun="true"</p><p>Enables STUN support for this connector. Ensure that the
        <code class="literal">ipAddress</code> attribute is not set to
        <code class="literal">127.0.0.1</code>.</p></li><li class="listitem"><p>stunServerAddress="&lt;Public_STUN_Server&gt;"</p><p>STUN server address used to discover the public IP address of
        this SIP Connector. See <a class="xref" href="ch08.html#tab-pss-Public_STUN_Servers" title="Table 8.1. Public STUN Servers">Table 8.1, “Public STUN Servers”</a>for a suggested list of public
        STUN servers.</p></li><li class="listitem"><p>stunServerPort="3478"</p><p>STUN server port of the STUN server used in the
        <code class="literal">stunServerAddress</code> attribute. Both TCP and UDP
        protocols communicate with STUN servers using this port only.</p></li></ul></div><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>A complete list of available SIP connector attributes and their
    descriptions is located in the <a class="xref" href="ch02.html#bsssc-binary-SIP_Servlets_Server-Adding_SIP_Connectors" title="2.3.1. Configuring SIP Connectors and Bindings">Section 2.3.1, “Configuring SIP Connectors and Bindings”</a>
    section of this guide.</p></div><p>A number of public STUN servers are available, and can be specified in
  the <code class="literal">stunServerAddress</code>. Depending on the router firmware used, the STUN reply
  packets' MAPPED_ADDRESS may be changed to the router's WAN port. To
  alleviate this problem, certain public STUN servers provide
  XOR_MAPPED_ADDRESS support. <a class="xref" href="ch08.html#tab-pss-Public_STUN_Servers" title="Table 8.1. Public STUN Servers">Table 8.1, “Public STUN Servers”</a>
  provides a selection of public STUN servers.</p><div class="table"><a id="tab-pss-Public_STUN_Servers"/><p class="title"><strong>Table 8.1. Public STUN Servers</strong></p><div class="table-contents"><table summary="Public STUN Servers" border="1"><colgroup><col align="left" class="c1"/><col align="left" class="c2"/><col align="left" class="c3"/></colgroup><thead><tr><th align="center">Server Address</th><th align="center">XOR Support</th><th align="center">DNS SRV Record</th></tr></thead><tbody><tr><td align="left">stun.ekiga.net</td><td align="left">Yes</td><td align="left">Yes</td></tr><tr><td align="left">stun.fwdnet.net</td><td align="left">No</td><td align="left">Yes</td></tr><tr><td align="left">stun.ideasip.com</td><td align="left">No</td><td align="left">Yes</td></tr><tr><td align="left">stun01.sipphone.com</td><td align="left">Yes</td><td align="left">No</td></tr><tr><td align="left">stun.softjoys.com</td><td align="left">No</td><td align="left">No</td></tr><tr><td align="left">stun.voipbuster.com</td><td align="left">No</td><td align="left">No</td></tr><tr><td align="left">stun.voxgratia.org</td><td align="left">No</td><td align="left">No</td></tr><tr><td align="left">stun.xten.com</td><td align="left">Yes</td><td align="left">Yes</td></tr><tr><td align="left">stunserver.org</td><td align="left">Yes</td><td align="left">Yes</td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>For more information about NAT traversal best practices, refer to <a class="xref" href="ch09.html#bp-Best_Practices_NAT" title="9.2. NAT Traversal">Section 9.2, “NAT Traversal”</a>.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sscacc-MSS_JSR289_Extensions"/>8.4. Mobicents vendor-specific Extensions to JSR 289</h2></div></div></div><p>Mobicents provide Extensions for applications or external systems to interact with the Mobicents SIP Servlets container as well as Extensions not defined in the specification in the JSR 289 specification that can prove useful and might be proposed for inclusion in a next release of the SIP Servlets specification </p><p><a class="ulink" href="http://ci.jboss.org/jenkins/view/Mobicents/job/MobicentsBooks/lastSuccessfulBuild/artifact/api-docs/jsr289/extensions/index.html">Javadoc for Mobicents JSR 289 Extensions</a></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="stf-CDI_Telco_Framework"/>8.5. CDI Telco Framework</h2></div></div></div><p>CDI is the Java standard for dependency injection and contextual lifecycle management, led by Gavin King for Red Hat, Inc. and is a Java Community Process(JCP) specification that integrates cleanly with the Java EE platform. Any Java EE 6-compliant application server provides support for JSR-299 (even the web profile). It seemed a natural fit create a new framework based on CDI for the Telco world.</p><p>CDI-Telco-Framework (CTF) from Mobicents brings the power and productivity benefits of CDI into the Mobicents Sip Servlets platform providing dependency injection and contextual lifecycle management for converged HTTP/SIP applications. This new framework is intended to become a replacement for our previous Seam Telco Framework.</p><p>CTF mission statement is to simplify SipServlets development by introducing a component based programming model, ease of development by making available SIP utilities out of the box, and finally providing dependency injection and contextual lifecycle management to the SipServlets.</p><div class="figure"><a id="d0e5665"/><p class="title"><strong>Figure 8.2. CDI Telco Framework Extension</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/CDI_Telco_Framework_Extension.png" alt="CDI Telco Framework Extension"/></div></div></div><br class="figure-break"/><p>More information about the CTF can be found on the <a class="ulink" href="http://docs.jboss.org/mobicents/frameworks/ctf/1.0.0.ALPHA1/user_guide/en-US/html_single/">CDI Telco Framework Documentation</a>. </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ssds-Diameter_Support"/>8.6. Diameter Support</h2></div></div></div><p>The Diameter Protocol (<a class="ulink" href="http://www.ietf.org/rfc/rfc3588.txt">RFC 3588</a>) is a computer networking protocol for Authentication, Authorization, and Accounting (AAA). The Diameter version included in Mobicents SIP Servlets currently support Base, Sh, Ro and Rf.</p><p>For more information regarding Diameter support, refer to the <a class="ulink" href="https://code.google.com/p/jdiameter/">Diameter Home Page</a>. For a list of Diameter examples, refer to <a class="xref" href="ch04.html" title="Chapter 4. SIP Servlet Example Applications">Chapter 4, <em>SIP Servlet Example Applications</em></a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="saimse-SIP_and_IMS_Extensions"/>8.7. SIP and IMS Extensions</h2></div></div></div><p>SIP Extensions in the SIP Servlets Server are based on the Internet Engineering Task Force's (IETF) Request for Comments (RFC) protocol recommendations. <a class="xref" href="ch08.html#tab-sse-Supported_SIP_Extensions" title="Table 8.2. Supported SIP Extensions">Table 8.2, “Supported SIP Extensions”</a> lists the supported RFCs for the SIP Servlets Server.</p><div class="table"><a id="tab-sse-Supported_SIP_Extensions"/><p class="title"><strong>Table 8.2. Supported SIP Extensions</strong></p><div class="table-contents"><table summary="Supported SIP Extensions" border="1"><colgroup><col align="left" class="c1"/><col align="left" class="c2"/><col align="left" class="c3"/></colgroup><thead><tr><th align="center">Extension</th><th align="center">RFC Number</th><th align="center">Description</th></tr></thead><tbody><tr><td align="left">DNS</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3263.txt">RFC 3263</a></td><td align="left">SIP: Locating SIP Servers</td></tr><tr><td align="left">ENUM</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc2916.txt">RFC 2916</a></td><td align="left">E.164 number and DNS</td></tr><tr><td align="left">INFO</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc2976.txt">RFC 2976</a></td><td align="left">The SIP INFO Method</td></tr><tr><td align="left">IPv6</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc2460.txt">RFC 2460</a></td><td align="left">Internet Protocol, Version 6 (IPv6) Specification</td></tr><tr><td align="left">JOIN</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3911.txt">RFC 3911</a></td><td align="left">The SIP "Join" Header</td></tr><tr><td align="left">MESSAGE</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3428.txt">RFC 3428</a></td><td align="left">SIP Extension for Instant Messaging</td></tr><tr><td align="left">PATH</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3327.txt">RFC 3327</a></td><td align="left">SIP Extension Header Field for Registering Non-Adjacent Contacts</td></tr><tr><td align="left">PRACK</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3262.txt">RFC 3262</a></td><td align="left">Reliability of Provisional Responses in the SIP</td></tr><tr><td align="left">PUBLISH</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3903.txt">RFC 3903</a></td><td align="left">SIP Extension for Event State Publication</td></tr><tr><td align="left">REASON</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3326.txt">RFC 3326</a></td><td align="left">The Reason Header Field for the Session Initiation Protocol (SIP)</td></tr><tr><td align="left">REFER</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3515.txt">RFC 3515</a></td><td align="left">The SIP Refer Method</td></tr><tr><td align="left">REPLACES</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3891.txt">RFC 3891</a></td><td align="left">The SIP "Replaces" Header</td></tr><tr><td align="left">STUN</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3489.txt">RFC 3489</a></td><td align="left">STUN - Simple Traversal of User Datagram Protocol (UDP) through Network Address Translators (NATs)</td></tr><tr><td align="left">SUBSCRIBE/NOTIFY</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3265.txt">RFC 3265</a></td><td align="left">SIP-specific Event Notification</td></tr><tr><td align="left">Symmetric Response Routing</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3581.txt">RFC 3581</a></td><td align="left">An Extension to the Session Initiation Protocol (SIP) for Symmetric Response Routing</td></tr><tr><td align="left">Multipart type</td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc4662.txt">RFC 4662</a></td><td align="left">A Session Initiation Protocol (SIP) Event Notification</td></tr><tr><td align="left">To/From Header Modification </td><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc4916.txt">RFC 4916</a></td><td align="left">Connected Identity in the Session Initiation Protocol (SIP)
</td></tr></tbody></table></div></div><br class="table-break"/><p>IMS Private Header (P-Header) Extensions are provided according to the recommendations of the <a class="ulink" href="http://www.3gpp.org/">3rd Generation Partnering Project (3GPP)</a> and the IETF. P-Header extensions are primarily used to store information about the networks a call traverses, including security or call charging details.</p><p><a class="xref" href="ch08.html#tab-sse-IMS_P-Header_Extensions" title="Table 8.3. IMS P-Header Extensions">Table 8.3, “IMS P-Header Extensions”</a> describes the list of supported P-Headers, including links to the relevant ITEF memorandum where available.</p><div class="table"><a id="tab-sse-IMS_P-Header_Extensions"/><p class="title"><strong>Table 8.3. IMS P-Header Extensions</strong></p><div class="table-contents"><table summary="IMS P-Header Extensions" border="1"><colgroup><col align="left" class="c1"/><col align="left" class="c2"/></colgroup><thead><tr><th align="center">Extension</th><th align="center">Description</th></tr></thead><tbody><tr><td align="left">AuthorizationHeaderIMS</td><td align="left">Defines a new auth-param for the Authorization header used in REGISTER requests.</td></tr><tr><td align="left">PAccessNetworkInfoHeader</td><td align="left">Contains information regarding the access network the User Agent (UA) uses to connect to the SIP Proxy. The information contained in this header may be sensitive, such as the cell ID, so it is important to secure all SIP application that interface with this header.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3324.txt">PAssertedIdentityHeader</a></td><td align="left">Contains an identity resulting from an authentication process, derived from a SIP network intermediary. The identity may be based on SIP Digest authentication.</td></tr><tr><td align="left">PAssertedServiceHeader</td><td align="left">Contains information used by "trust domains", according to Spec(T) specifications detailed in <a class="ulink" href="http://www.ietf.org/rfc/rfc3324.txt">RFC 3324</a>.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3455.txt">PAssociatedURIHeader</a></td><td align="left">Contains a list of URIs that are allocated to the user. The header is defined in the 200 OK response to a REGISTER request. It allows the User Agent Client (UAC) to determine the URIs the service provider has associated to the user's address-of-record URI.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3327.txt">PathHeader</a></td><td align="left">SIP Extension header, with syntax similar to the RecordRoute header. Used in conjunction with SIP REGISTER requests and 200 class messages in response to REGISTER responses.</td></tr><tr><td align="left">PCalledPartyIDHeader</td><td align="left">Typically inserted en-route into an INVITE request by the proxy, the header is populated with the Request_URI received by the proxy in the request. The header allows the User Agent Server (UAS) to identify which address-of-record the invitation was sent to, and can be used to render distinctive audio-visual alert notes based on the URI.</td></tr><tr><td align="left">PChargingFunctionAddressesHeader</td><td align="left">Contains a list of one or more of the Charging Collection Function (CCF) and the Event Charging Function (ECF) addresses. The CCF and ECF addresses may be passed during the establishment of a dialog, or in a standalone transaction.</td></tr><tr><td align="left">PChargingVectorHeader</td><td align="left">Contains a unique charging identifier and correlation information, which is used by network operators to correctly charge for routing events through their networks.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3313.txt">PMediaAuthorizationHeader</a></td><td align="left">Contains one or more session-specific media authorization tokens, which are used for QoS of the media streams.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3325.txt">PPreferredIdentityHeader</a></td><td align="left">Contains a SIP URI and an optional display-name.  For example, "James May" &lt;sip:james@domain.com&gt;. This header is used by trusted proxy servers to identify the user to other trusted proxies, and can be used to select the correct SIP URI in the case of multiple user identities.</td></tr><tr><td align="left">PPreferredServiceHeader</td><td align="left">Used by the PAssertedService Header to determine the preferred user service.  Multiple PPreferreedService headers may be present in a single request.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc5002.txt">PProfileKeyHeader</a></td><td align="left">Contains a key used by a proxy to query the user database for a given profile. The key may contain wildcards that are used as part of the query into the database.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3323.txt">PrivacyHeader</a></td><td align="left">Contains values that determine whether particular header information is deemed as private by the UA for requests and responses.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc5502.txt">PServedUserHeader</a></td><td align="left">Contains an identity of the user that represents the served user. The header is added to the initial requests for a dialog or standalone request, which are then routed between nodes in a trusted domain.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc4457.txt">PUserDatabaseHeader</a></td><td align="left">Contains the address of the HSS handling the user that generated the request. The header field is added to request routed from an Interrogating Call Session Control Function (I-CSCF) to a Serving Call Session Control Function (S-CSCF).</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3455.txt">PVisitedNetworkIDHeader</a></td><td align="left">Contains the identifier of a visited network. The identifier is a text string or token than it known by both the registrar or the home proxy at the home network, and the proxies in the visited network.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3329.txt">SecurityClientHeader, SecurityServerHeader, SecurityVerifyHeader</a></td><td align="left">Contains information used to negotiate the security mechanisms between a UAC, and other SIP entities including UAS, proxy and registrar.</td></tr><tr><td align="left"><a class="ulink" href="http://www.ietf.org/rfc/rfc3608.txt">ServiceRouteHeader</a></td><td align="left">Contains a route vector that will direct requests through a specified sequence of proxies. The header may be included by a registrar in response to a REGISTER request.</td></tr><tr><td align="left"><a class="ulink" href="http://snad.ncsl.nist.gov/proj/iptel/jain-sip-1.2/javadoc/gov/nist/javax/sip/header/ims/WWWAuthenticateHeaderIms.html">WWWAuthenticateHeaderIms</a></td><td align="left">Extends the WWWAuthenticateResponse header functionality by defining an additional authorization parameter (auth-param).</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ss_jslee_interop"/>8.8. SIP Servlets - JAIN SLEE Interoperability</h2></div></div></div><p>JAIN SLEE is a more complex specification than SIP Servlets, and it
  has been know as heavyweight and with a steep learning curve. However JAIN
  SLEE has standardized a high performing event driven application server, an
  execution environment with a good concurrency model and powerful protocol
  agnostic capabilities thus covering a variety of Telco protocols.</p><p>SIP Servlets on the other hand is much simpler and easier to get started
  with. Its focus is on extending the HTTP Servlets and Java EE hosting
  environments with SIP capabilities. SIP Servlets is more of a SIP
  programming framework, while JSLEE is a complete, self sufficient application
  platform. The fact that SIP Servlets is focused on SIP and
  Java EE makes it a natural fit to build JEE converged applications.</p><div class="table"><a id="tab-ss_vs_jslee"/><p class="title"><strong>Table 8.4. SIP Servlets / JAIN SLEE Comparison Table</strong></p><div class="table-contents"><table summary="SIP Servlets / JAIN SLEE Comparison Table" border="1"><colgroup><col align="left" class="c1"/><col align="left" class="c2"/></colgroup><thead><tr><th align="center">SIP Servlets</th><th align="center">JAIN SLEE</th></tr></thead><tbody><tr><td colspan="2" align="center">
              <span class="bold"><strong>Application Architecture</strong></span>
            </td></tr><tr><td align="center">Based on HTTP Servlets. Unit of logic is the SIP Servlets</td><td align="center">Component based, Object Orientated architecture. Unit of logic is the Service Building Block</td></tr><tr><td align="center">Composition through Application Router</td><td align="center">Composition through parent-child relationship</td></tr><tr><td colspan="2" align="center">
              <span class="bold"><strong>Application State</strong></span>
            </td></tr><tr><td align="center">Servlets are stateless</td><td align="center">SBBs may be stateful</td></tr><tr><td align="center">Shared state stored in a session and visible to all Servlets with access to the session</td><td align="center">SBB state is transacted and a property of the SBB itself. Shared state may be stored in a separate ActivityContext via a type safe interface</td></tr><tr><td colspan="2" align="center">
              <span class="bold"><strong>Concurrency Control</strong></span>
            </td></tr><tr><td align="center">Application managed: use of Java monitors</td><td align="center">System Managed: isolation of concurrent transactions</td></tr><tr><td colspan="2" align="center">
              <span class="bold"><strong>Facilities (Utilities for Applications)</strong></span>
            </td></tr><tr><td align="center">Timer, Listeners</td><td align="center">Timer, Trace, Alarm, Statistics, Profiles.</td></tr><tr><td colspan="2" align="center">
              <span class="bold"><strong>Protocol Support</strong></span>
            </td></tr><tr><td align="center">SIP, HTTP and Media (JSR 309)</td><td align="center">Protocol agnostic. Consistent event model, regardless of protocol/resource</td></tr><tr><td colspan="2" align="center">
              <span class="bold"><strong>Availability Mechanisms</strong></span>
            </td></tr><tr><td align="center">Container managed state (session object) that can be replicated</td><td align="center">Container managed state (SBB CMP, Facility, ActivityContext) that can be replicated</td></tr><tr><td align="center">No transaction context for SIP message processing</td><td align="center">Transaction context for event delivery</td></tr><tr><td align="center">Non transacted state operations</td><td align="center">Container managed state operations are transacted</td></tr><tr><td align="center">Facilities are non transacted</td><td align="center">Facilities, timers, are transacted</td></tr><tr><td align="center">No defined failure model</td><td align="center">Well defined and understood failure model via transactions</td></tr><tr><td colspan="2" align="center">
              <span class="bold"><strong>Management</strong></span>
            </td></tr><tr><td align="center">No standard management mechanisms defined</td><td align="center">JMX Interface for managing applications, life cycle, upgrades, ...</td></tr></tbody></table></div></div><p><br class="table-break"/></p><p>JSLEE and SIP Servlets target different audiences with different needs,
  but they can be complementary in a number of real world cases.</p><p>SIP Servlets focuses on SIP and its integration with Java EE. It is
  also more of a SIP framework within Java EE. JSLEE is an event driven
  application server with protocol agnostic architecture, spanning any legacy
  or potential future protocols. SIP Servlets applications are generally
  simpler to implement and accelerate time to market for Web and SIP
  deployment scenarios. JSLEE has a steeper learning curve and covers a wider
  set of target deployment environments.</p><p>As JBoss is the only vendor to implement both specifications through
  Mobicents, this makes it a natural fit to build converged and interoperable
  JSLEE/SIP Servlets applications that are able to comply with standards in a
  portable manner. We built an application that could leverage standards all
  the way without resorting to vendor proprietary extensions by making SIP
  Servlets and JSLEE work together. <a class="ulink" href="http://mobicents.googlecode.com/files/deruelle-JSleeSipServletsInteroperability-final.pdf">Our "JSLEE and SIP-Servlets Interoperability with Mobicents Communication Platform" paper</a> describes our approach and the possible different
  approaches we have identified to achieve the goal of interoperability
  between SIP Servlets and JSLEE.</p><p>You can also use our <a class="ulink" href="https://code.google.com/p/sipservlets/source/browse/#git%2Fsip-servlets-examples%2Fjslee-sips-interop">JSLEE/SIP Servlets interoperability example</a>, showcasing our approach.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6130"/>8.9. Eclipse IDE Tools</h2></div></div></div><p>The SIP Servlets Eclipse tools assist developers in creating JSR-289 applications with Mobicents. You can use the Dynamic Web Project wizard for converged applications to get started with an empty project, and then test your application with a real SIP Phone right from the IDE.</p><div class="figure"><a id="d0e6135"/><p class="title"><strong>Figure 8.3. SIP Servlets Eclipse IDE Tools</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/mss-ide-screen.png" alt="SIP Servlets Eclipse IDE Tools"/></div></div></div><br class="figure-break"/><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6141"/>8.9.1. Pre-Install requirements</h3></div></div></div><p>Eclipse 3.4 is required.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6146"/>8.9.2. Installation</h3></div></div></div><p>The standard Eclipse update site installation mechanism is leveraged. The Mobicents Update Site is at the following location: <a class="ulink" href="http://mobicents.googlecode.com/svn/downloads/sip-servlets-eclipse-update-site">http://mobicents.googlecode.com/svn/downloads/sip-servlets-eclipse-update-site</a>. After adding this update site to Eclipse you can proceed with the regular Eclipse Plug-in Installation. If you need help, the process is demonstrated in <a class="ulink" href="http://www.youtube.com/watch?v=LZOmLEC2IeQ">this video</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6157"/>8.9.3. SIP Servlets Core Plug-in</h3></div></div></div><p>This plug-in allows you to create Dynamic Web Projects with the SIP Facet. There are a number of new Dynamic Web Project configurations for Converged applications. It is best to use the ones marked as "recommended". After you complete the wizard, a complete converged project skeleton will be generated. Working with this type of project is similar to working with normal Web projects. You can see a demo <a class="ulink" href="http://people.redhat.com/vralev/mss-eclipse-plugin-demo/mss-eclipse.htm">here</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6165"/>8.9.4. SIP Phone Plug-in</h3></div></div></div><p>The SIP Phone plug-in integrates a SIP phone inside your Eclipse IDE. You can use the phone to test your SIP or Media applications. The phone uses the microphone and speakers on your computer and allows you to simulate real-world scenarios.</p></div></div></div><ul xmlns:d="http://docbook.org/ns/docbook" class="docnav"><li class="previous"><a accesskey="p" href="ch07.html"><strong>Prev</strong>Chapter 7. Security</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="ch09.html"><strong>Next</strong>Chapter 9. Best Practices</a></li></ul></body></html>